name: Refresh Baseline Predictions

on:
  workflow_dispatch:
  schedule:
    - cron: "15 6 * * *"  # 06:15 UTC daily

jobs:
  refresh:
    runs-on: ubuntu-latest
    steps:
      - name: POST /admin/refresh (baseline odds → probs)
        run: |
          curl -X POST "$API_BASE/admin/refresh" \
            -H "accept: application/json" \
            -H "x-admin-token: $ADMIN_TOKEN" \
            -H "Content-Type: application/json" \
            -d "$UPSERT_MATCHES_JSON"
        env:
          API_BASE: https://ia-sport.onrender.com
          ADMIN_TOKEN: ${{ secrets.ADMIN_TOKEN }}
          # Exemple de payload à garder dans les secrets (modifiable depuis GH):
          # {"date":"2025-10-29","league_id":"L1","matches":[{"home":"PSG","away":"OM","version":"baseline-v1","odds":{"home":1.72,"draw":3.85,"away":5.10,"over25":1.82,"under25":2.02}}, {"home":"Lyon","away":"Monaco","version":"baseline-v1","odds":{"home":2.60,"draw":3.30,"away":2.80}}]}
          UPSERT_MATCHES_JSON: ${{ secrets.UPSERT_MATCHES_JSON }}
